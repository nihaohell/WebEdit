/*
 Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
*/
(function(){function I(b,l,d){function c(c){if(!(!(a=f[c?"getFirst":"getLast"]())||a.is&&a.isBlockBoundary()||!(p=l.root[c?"getPrevious":"getNext"](CKEDITOR.dom.walker.invisible(!0)))||p.is&&p.isBlockBoundary({br:1})))b.document.createElement("br")[c?"insertBefore":"insertAfter"](a)}for(var e=CKEDITOR.plugins.list.listToArray(l.root,d),g=[],h=0;h<l.contents.length;h++){var k=l.contents[h];(k=k.getAscendant("li",!0))&&!k.getCustomData("list_item_processed")&&(g.push(k),CKEDITOR.dom.element.setMarker(d,
k,"list_item_processed",!0))}k=null;for(h=0;h<g.length;h++)k=g[h].getCustomData("listarray_index"),e[k].indent=-1;for(h=k+1;h<e.length;h++)if(e[h].indent>e[h-1].indent+1){g=e[h-1].indent+1-e[h].indent;for(k=e[h].indent;e[h]&&e[h].indent>=k;)e[h].indent+=g,h++;h--}var f=CKEDITOR.plugins.list.arrayToList(e,d,null,b.config.enterMode,l.root.getAttribute("dir")).listNode,a,p;c(!0);c();f.replace(l.root);b.fire("contentDomInvalidated")}function B(b,l){this.name=b;this.context=this.type=l;this.allowedContent=
l+" li";this.requiredContent=l}function E(b,l,d,c){for(var e,g;e=b[c?"getLast":"getFirst"](J);)(g=e.getDirection(1))!==l.getDirection(1)&&e.setAttribute("dir",g),e.remove(),d?e[c?"insertBefore":"insertAfter"](d):l.append(e,c)}function F(b){function l(d){var c=b[d?"getPrevious":"getNext"](u);c&&c.type==CKEDITOR.NODE_ELEMENT&&c.is(b.getName())&&(E(b,c,null,!d),b.remove(),b=c)}l();l(1)}function G(b){return b.type==CKEDITOR.NODE_ELEMENT&&(b.getName()in CKEDITOR.dtd.$block||b.getName()in CKEDITOR.dtd.$listItem)&&
CKEDITOR.dtd[b.getName()]["#"]}function C(b,l,d){b.fire("saveSnapshot");d.enlarge(CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS);var c=d.extractContents();l.trim(!1,!0);var e=l.createBookmark(),g=new CKEDITOR.dom.elementPath(l.startContainer),h=g.block,g=g.lastElement.getAscendant("li",1)||h,k=new CKEDITOR.dom.elementPath(d.startContainer),f=k.contains(CKEDITOR.dtd.$listItem),k=k.contains(CKEDITOR.dtd.$list);h?(h=h.getBogus())&&h.remove():k&&(h=k.getPrevious(u))&&z(h)&&h.remove();(h=c.getLast())&&h.type==CKEDITOR.NODE_ELEMENT&&
h.is("br")&&h.remove();(h=l.startContainer.getChild(l.startOffset))?c.insertBefore(h):l.startContainer.append(c);f&&(c=A(f))&&(g.contains(f)?(E(c,f.getParent(),f),c.remove()):g.append(c));for(;d.checkStartOfBlock()&&d.checkEndOfBlock();){k=d.startPath();c=k.block;if(!c)break;c.is("li")&&(g=c.getParent(),c.equals(g.getLast(u))&&c.equals(g.getFirst(u))&&(c=g));d.moveToPosition(c,CKEDITOR.POSITION_BEFORE_START);c.remove()}d=d.clone();c=b.editable();d.setEndAt(c,CKEDITOR.POSITION_BEFORE_END);d=new CKEDITOR.dom.walker(d);
d.evaluator=function(a){return u(a)&&!z(a)};(d=d.next())&&d.type==CKEDITOR.NODE_ELEMENT&&d.getName()in CKEDITOR.dtd.$list&&F(d);l.moveToBookmark(e);l.select();b.fire("saveSnapshot")}function A(b){return(b=b.getLast(u))&&b.type==CKEDITOR.NODE_ELEMENT&&b.getName()in v?b:null}var v={ol:1,ul:1},K=CKEDITOR.dom.walker.whitespaces(),H=CKEDITOR.dom.walker.bookmark(),u=function(b){return!(K(b)||H(b))},z=CKEDITOR.dom.walker.bogus();CKEDITOR.plugins.list={listToArray:function(b,l,d,c,e){if(!v[b.getName()])return[];
c||(c=0);d||(d=[]);for(var g=0,h=b.getChildCount();g<h;g++){var k=b.getChild(g);k.type==CKEDITOR.NODE_ELEMENT&&k.getName()in CKEDITOR.dtd.$list&&CKEDITOR.plugins.list.listToArray(k,l,d,c+1);if("li"==k.$.nodeName.toLowerCase()){var f={parent:b,indent:c,element:k,contents:[]};e?f.grandparent=e:(f.grandparent=b.getParent(),f.grandparent&&"li"==f.grandparent.$.nodeName.toLowerCase()&&(f.grandparent=f.grandparent.getParent()));l&&CKEDITOR.dom.element.setMarker(l,k,"listarray_index",d.length);d.push(f);
for(var a=0,p=k.getChildCount(),m;a<p;a++)m=k.getChild(a),m.type==CKEDITOR.NODE_ELEMENT&&v[m.getName()]?CKEDITOR.plugins.list.listToArray(m,l,d,c+1,f.grandparent):f.contents.push(m)}}return d},arrayToList:function(b,l,d,c,e){d||(d=0);if(!b||b.length<d+1)return null;for(var g,h=b[d].parent.getDocument(),k=new CKEDITOR.dom.documentFragment(h),f=null,a=d,p=Math.max(b[d].indent,0),m=null,q,n,t=c==CKEDITOR.ENTER_P?"p":"div";;){var r=b[a];g=r.grandparent;q=r.element.getDirection(1);if(r.indent==p){f&&b[a].parent.getName()==
f.getName()||(f=b[a].parent.clone(!1,1),e&&f.setAttribute("dir",e),k.append(f));m=f.append(r.element.clone(0,1));q!=f.getDirection(1)&&m.setAttribute("dir",q);for(g=0;g<r.contents.length;g++)m.append(r.contents[g].clone(1,1));a++}else if(r.indent==Math.max(p,0)+1)r=b[a-1].element.getDirection(1),a=CKEDITOR.plugins.list.arrayToList(b,null,a,c,r!=q?q:null),!m.getChildCount()&&CKEDITOR.env.needsNbspFiller&&7>=h.$.documentMode&&m.append(h.createText(" ")),m.append(a.listNode),a=a.nextIndex;else if(-1==
r.indent&&!d&&g){v[g.getName()]?(m=r.element.clone(!1,!0),q!=g.getDirection(1)&&m.setAttribute("dir",q)):m=new CKEDITOR.dom.documentFragment(h);var f=g.getDirection(1)!=q,y=r.element,D=y.getAttribute("class"),z=y.getAttribute("style"),A=m.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT&&(c!=CKEDITOR.ENTER_BR||f||z||D),w,B=r.contents.length,x;for(g=0;g<B;g++)if(w=r.contents[g],H(w)&&1<B)A?x=w.clone(1,1):m.append(w.clone(1,1));else if(w.type==CKEDITOR.NODE_ELEMENT&&w.isBlockBoundary()){f&&!w.getDirection()&&
w.setAttribute("dir",q);n=w;var C=y.getAttribute("style");C&&n.setAttribute("style",C.replace(/([^;])$/,"$1;")+(n.getAttribute("style")||""));D&&w.addClass(D);n=null;x&&(m.append(x),x=null);m.append(w.clone(1,1))}else A?(n||(n=h.createElement(t),m.append(n),f&&n.setAttribute("dir",q)),z&&n.setAttribute("style",z),D&&n.setAttribute("class",D),x&&(n.append(x),x=null),n.append(w.clone(1,1))):m.append(w.clone(1,1));x&&((n||m).append(x),x=null);m.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT&&a!=b.length-1&&(CKEDITOR.env.needsBrFiller&&
(q=m.getLast())&&q.type==CKEDITOR.NODE_ELEMENT&&q.is("br")&&q.remove(),(q=m.getLast(u))&&q.type==CKEDITOR.NODE_ELEMENT&&q.is(CKEDITOR.dtd.$block)||m.append(h.createElement("br")));q=m.$.nodeName.toLowerCase();"div"!=q&&"p"!=q||m.appendBogus();k.append(m);f=null;a++}else return null;n=null;if(b.length<=a||Math.max(b[a].indent,0)<p)break}if(l)for(b=k.getFirst();b;){if(b.type==CKEDITOR.NODE_ELEMENT&&(CKEDITOR.dom.element.clearMarkers(l,b),b.getName()in CKEDITOR.dtd.$listItem&&(d=b,h=e=c=void 0,c=d.getDirection()))){for(e=
d.getParent();e&&!(h=e.getDirection());)e=e.getParent();c==h&&d.removeAttribute("dir")}b=b.getNextSourceNode()}return{listNode:k,nextIndex:a}}};var L=/^h[1-6]$/,J=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_ELEMENT);B.prototype={exec:function(b){this.refresh(b,b.elementPath());var l=b.config,d=b.getSelection(),c=d&&d.getRanges();if(this.state==CKEDITOR.TRISTATE_OFF){var e=b.editable();if(e.getFirst(u)){var g=1==c.length&&c[0];(l=g&&g.getEnclosedNode())&&l.is&&this.type==l.getName()&&this.setState(CKEDITOR.TRISTATE_ON)}else l.enterMode==
CKEDITOR.ENTER_BR?e.appendBogus():c[0].fixBlock(1,l.enterMode==CKEDITOR.ENTER_P?"p":"div"),d.selectRanges(c)}for(var l=d.createBookmarks(!0),e=[],h={},c=c.createIterator(),k=0;(g=c.getNextRange())&&++k;){var f=g.getBoundaryNodes(),a=f.startNode,p=f.endNode;a.type==CKEDITOR.NODE_ELEMENT&&"td"==a.getName()&&g.setStartAt(f.startNode,CKEDITOR.POSITION_AFTER_START);p.type==CKEDITOR.NODE_ELEMENT&&"td"==p.getName()&&g.setEndAt(f.endNode,CKEDITOR.POSITION_BEFORE_END);g=g.createIterator();for(g.forceBrBreak=
this.state==CKEDITOR.TRISTATE_OFF;f=g.getNextParagraph();)if(!f.getCustomData("list_block")){CKEDITOR.dom.element.setMarker(h,f,"list_block",1);for(var m=b.elementPath(f),a=m.elements,p=0,m=m.blockLimit,q,n=a.length-1;0<=n&&(q=a[n]);n--)if(v[q.getName()]&&m.contains(q)){m.removeCustomData("list_group_object_"+k);(a=q.getCustomData("list_group_object"))?a.contents.push(f):(a={root:q,contents:[f]},e.push(a),CKEDITOR.dom.element.setMarker(h,q,"list_group_object",a));p=1;break}p||(p=m,p.getCustomData("list_group_object_"+
k)?p.getCustomData("list_group_object_"+k).contents.push(f):(a={root:p,contents:[f]},CKEDITOR.dom.element.setMarker(h,p,"list_group_object_"+k,a),e.push(a)))}}for(q=[];0<e.length;)if(a=e.shift(),this.state==CKEDITOR.TRISTATE_OFF)if(v[a.root.getName()]){c=b;k=a;a=h;g=q;p=CKEDITOR.plugins.list.listToArray(k.root,a);m=[];for(f=0;f<k.contents.length;f++)n=k.contents[f],(n=n.getAscendant("li",!0))&&!n.getCustomData("list_item_processed")&&(m.push(n),CKEDITOR.dom.element.setMarker(a,n,"list_item_processed",
!0));for(var n=k.root.getDocument(),t=void 0,r=void 0,f=0;f<m.length;f++){var y=m[f].getCustomData("listarray_index"),t=p[y].parent;t.is(this.type)||(r=n.createElement(this.type),t.copyAttributes(r,{start:1,type:1}),r.removeStyle("list-style-type"),p[y].parent=r)}a=CKEDITOR.plugins.list.arrayToList(p,a,null,c.config.enterMode);p=void 0;m=a.listNode.getChildCount();for(f=0;f<m&&(p=a.listNode.getChild(f));f++)p.getName()==this.type&&g.push(p);a.listNode.replace(k.root);c.fire("contentDomInvalidated")}else{p=
b;g=a;f=q;m=g.contents;c=g.root.getDocument();k=[];1==m.length&&m[0].equals(g.root)&&(a=c.createElement("div"),m[0].moveChildren&&m[0].moveChildren(a),m[0].append(a),m[0]=a);g=g.contents[0].getParent();for(n=0;n<m.length;n++)g=g.getCommonAncestor(m[n].getParent());t=p.config.useComputedState;p=a=void 0;t=void 0===t||t;for(n=0;n<m.length;n++)for(r=m[n];y=r.getParent();){if(y.equals(g)){k.push(r);!p&&r.getDirection()&&(p=1);r=r.getDirection(t);null!==a&&(a=a&&a!=r?null:r);break}r=y}if(!(1>k.length)){m=
k[k.length-1].getNext();n=c.createElement(this.type);f.push(n);for(t=f=void 0;k.length;)f=k.shift(),t=c.createElement("li"),r=f,r.is("pre")||L.test(r.getName())||"false"==r.getAttribute("contenteditable")?f.appendTo(t):(f.copyAttributes(t),a&&f.getDirection()&&(t.removeStyle("direction"),t.removeAttribute("dir")),f.moveChildren(t),f.remove()),t.appendTo(n);a&&p&&n.setAttribute("dir",a);m?n.insertBefore(m):n.appendTo(g)}}else this.state==CKEDITOR.TRISTATE_ON&&v[a.root.getName()]&&I.call(this,b,a,h);
for(n=0;n<q.length;n++)F(q[n]);CKEDITOR.dom.element.clearAllMarkers(h);d.selectBookmarks(l);b.focus()},refresh:function(b,l){var d=l.contains(v,1),c=l.blockLimit||l.root;d&&c.contains(d)?this.setState(d.is(this.type)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF):this.setState(CKEDITOR.TRISTATE_OFF)}};CKEDITOR.plugins.add("list",{lang:"en,zh-cn",icons:"bulletedlist,bulletedlist-rtl,numberedlist,numberedlist-rtl",icontype:".svg",iconoffset:"center",iconbgsize:"16px",hidpi:!1,requires:"indentlist,richcombo",
init:function(b){b.blockless||(b.addCommand("numberedlist",new B("numberedlist","ol")),b.addCommand("bulletedlist",new B("bulletedlist","ul")),b.ui.addButton&&(b.ui.addButton("NumberedList",{label:b.lang.list.numberedlist,command:"numberedlist",directional:!0}),b.ui.addButton("BulletedList",{label:b.lang.list.bulletedlist,command:"bulletedlist",directional:!0})),b.ui.addRichCombo&&b.ui.addRichCombo("PanelList",{icon:"bulletedlist",label:"列表",title:"列表",panel:{css:[CKEDITOR.skin.getPath("editor")].concat(b.config.contentsCss),
multiSelect:!1,attributes:{"aria-label":"列表"}},init:function(){this.startGroup("列表");var l=["numberedlist","bulletedlist"],d;for(d in l){var c=l[d],e=CKEDITOR.skin.getIconStyle(c,"rtl"==b.lang.dir,void 0,void 0);this.add(c,'\x3cspan class\x3d"cke_combo_icon cke_combo_icon__panellist cke_button_icon" style\x3d"'+e+'"\x3e'+b.lang.list[c]+"\x3c/span\x3e",b.lang.list[c])}},onClick:function(l){b.focus();b.fire("saveSnapshot");b.execCommand(l);setTimeout(function(){b.fire("saveSnapshot")},0)},onRender:function(){b.on("selectionChange",
function(b){this.getValue();b=b.data.path.elements;for(var d=0,c=b.length,e;d<c;d++)if(e=b[d],"ol"===e.getName()){this.setValue("numberedlist");break}else if("ul"===e.getName()){this.setValue("bulletedlist");break}else this.setValue("")},this)},refresh:function(b,d){if(b){var c=b.elementPath();if(c){for(var c=c.elements,e=0,g=c.length,h;e<g;e++)if(h=c[e],"ol"===h.getName()){this.setValue("numberedlist");break}else if("ul"===h.getName()){this.setValue("bulletedlist");break}else this.setValue("");c=
d.contains(v,1);e=d.blockLimit||d.root;c&&e.contains(c)?this.setState(c.is(this.type)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF):this.setState(CKEDITOR.TRISTATE_OFF)}}}}),b.on("key",function(l){var d=l.data.domEvent.getKey(),c;if("wysiwyg"==b.mode&&d in{8:1,46:1}){var e=b.getSelection().getRanges()[0],g=e&&e.startPath();if(e&&e.collapsed){var h=8==d,k=b.editable(),f=new CKEDITOR.dom.walker(e.clone());f.evaluator=function(a){return u(a)&&!z(a)};f.guard=function(a,b){return!(b&&a.type==CKEDITOR.NODE_ELEMENT&&
a.is("table"))};d=e.clone();if(h){var a;(a=g.contains(v))&&e.checkBoundaryOfElement(a,CKEDITOR.START)&&(a=a.getParent())&&a.is("li")&&(a=A(a))?(c=a,a=a.getPrevious(u),d.moveToPosition(a&&z(a)?a:c,CKEDITOR.POSITION_BEFORE_START)):(f.range.setStartAt(k,CKEDITOR.POSITION_AFTER_START),f.range.setEnd(e.startContainer,e.startOffset),(a=f.previous())&&a.type==CKEDITOR.NODE_ELEMENT&&(a.getName()in v||a.is("li"))&&(a.is("li")||(f.range.selectNodeContents(a),f.reset(),f.evaluator=G,a=f.previous()),c=a,d.moveToElementEditEnd(c),
d.moveToPosition(d.endPath().block,CKEDITOR.POSITION_BEFORE_END)));if(c)C(b,d,e),l.cancel();else{var p=g.contains(v);p&&e.checkBoundaryOfElement(p,CKEDITOR.START)&&(c=p.getFirst(u),e.checkBoundaryOfElement(c,CKEDITOR.START)&&(a=p.getPrevious(u),A(c)?a&&(e.moveToElementEditEnd(a),e.select()):b.execCommand("outdent"),l.cancel()))}}else if(c=g.contains("li")){if(f.range.setEndAt(k,CKEDITOR.POSITION_BEFORE_END),h=(k=c.getLast(u))&&G(k)?k:c,g=0,(a=f.next())&&a.type==CKEDITOR.NODE_ELEMENT&&a.getName()in
v&&a.equals(k)?(g=1,a=f.next()):e.checkBoundaryOfElement(h,CKEDITOR.END)&&(g=2),g&&a){e=e.clone();e.moveToElementEditStart(a);if(1==g&&(d.optimize(),!d.startContainer.equals(c))){for(c=d.startContainer;c.is(CKEDITOR.dtd.$inline);)p=c,c=c.getParent();p&&d.moveToPosition(p,CKEDITOR.POSITION_AFTER_END)}2==g&&(d.moveToPosition(d.endPath().block,CKEDITOR.POSITION_BEFORE_END),e.endPath().block&&e.moveToPosition(e.endPath().block,CKEDITOR.POSITION_AFTER_START));C(b,d,e);l.cancel()}}else f.range.setEndAt(k,
CKEDITOR.POSITION_BEFORE_END),(a=f.next())&&a.type==CKEDITOR.NODE_ELEMENT&&a.is(v)&&(a=a.getFirst(u),g.block&&e.checkStartOfBlock()&&e.checkEndOfBlock()?(g.block.remove(),e.moveToElementEditStart(a),e.select()):A(a)?(e.moveToElementEditStart(a),e.select()):(e=e.clone(),e.moveToElementEditStart(a),C(b,d,e)),l.cancel());setTimeout(function(){b.selectionChange(1)})}}}))}})})();