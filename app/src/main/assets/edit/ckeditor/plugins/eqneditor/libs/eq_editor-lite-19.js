function EqTextArea(a,b,c,d,f){this.changed=!1;this.orgtxt="";this.bArray_id=[];this.bArray_area=[];this.bArray_mode=[];this.bsize=0;this.updateExportArea=function(){for(i=0;i<this.bsize;i++){var a=this.exportEquation(this.bArray_mode[i]);void 0!==this.bArray_area[i].src?this.bArray_area[i].src=a:void 0!==this.bArray_area[i].value?this.bArray_area[i].value=a:void 0!==this.bArray_area[i].innerHTML&&(this.bArray_area[i].innerHTML=a)}};this.addExportArea=function(a,b){var c=EqEditor.$(a);c&&(this.bArray_id[this.bsize]=
a,this.bArray_area[this.bsize]=c,this.bArray_mode[this.bsize]=b,this.bsize++)};this.changeExportArea=function(a,b){for(i=0;i<this.bsize;i++)a==this.bArray_id[i]&&(this.bArray_mode[i]=b,i=this.bsize)};this.myRedo=this.myUndo=0;this.store_text=[];this.store_text.push("");this.addEvent=function(a,b){this.equation_input.addEventListener?this.equation_input.addEventListener(a,b,!1):this.equation_input.attachEvent("on"+a,b)};this.set=function(a,b,c,d,f){if(void 0==a||""==a)a="equationview";if(void 0==b||
""==b)b="latex_formula";if(void 0==c||""==c)c="equationcomment";if(void 0==d||""==d)d="download";if(void 0==f||""==f)f="intro";this.equation_preview=EqEditor.$(a);this.equation_input=EqEditor.$(b);this.equation_comment=EqEditor.$(c);this.equation_download=EqEditor.$(d);this.intro_text=f;this.equation_input&&(this.addEvent("keydown",function(a){EqEditor.Panel.close();EqEditor.countclick();EqEditor.tabHandler(a)}),this.addEvent("keyup",function(){EqEditor.textchanged();EqEditor.autorenderEqn(10)}),
this.addEvent("keypress",function(a){EqEditor.keyHandler(a)}),EqEditor.$(this.intro_text)&&(EqEditor.$(this.intro_text).onclick=function(a){EqEditor.targetArea.equation_input.focus();EqEditor.Opacity.fadeout(this.intro_text)}))};this.setText=function(a){a=unescape(a.replace(/\&space;/g," ").replace(/\&plus;/g,"+").replace(/\&hash;/g,"#").replace(/\@plus;/g,"+").replace(/\@hash;/g,"#"));EqEditor.reset();var b,c,d;do d=0,a=a.replace(RegExp("^[\\s]+","g"),""),b=a.indexOf(" "),c=a.indexOf("}"),-1!=c&&
(c<b||-1==b)&&(b=c),-1!=b&&(c=a.substr(0,b),EqEditor.setSelIndx("fontsize",c)&&(d=1),"\\inline"==c&&(EqEditor.$("inline").checked=!0,EqEditor.$("compressed").checked=!0,d=1),"\\bg_"==c.substr(0,4)&&EqEditor.setSelIndx("bg",c.substr(4))&&(d=1),"\\fn_"==c.substr(0,4)&&EqEditor.setSelIndx("font",c.substr(4))&&(d=1),"\\dpi{"==c.substr(0,5)&&EqEditor.setSelIndx("dpi",c.substr(5))&&(d=1),d&&(a=a.substr(b+1)));while(d);0<a.length&&(this.equation_input.value=a,this.textchanged(),this.renderEqn())};this.clearText=
function(){this.equation_input.value="";this.equation_input.focus();this.changed=!1;this.equation_preview.src=EDITOR_SRC+"/images/spacer.gif";EqEditor.Opacity.fadein(this.intro_text)};this.textchanged=function(){var a=this.getEquationStr();0==a.length?EqEditor.Opacity.fadein(this.intro_text):EqEditor.Opacity.fadeout(this.intro_text);return a!=this.orgtxt?(this.orgtxt=a,this.changed=!0):!1};this.auton=0;this.renderCountdown=function(){if(0<this.auton){this.auton--;var a=new Function(this.renderCountdown());
setTimeout(a,100)}else this.renderEqn(null)};this.autorenderEqn=function(a){0<this.auton&&0<a?this.auton=a:(this.auton=a,this.renderCountdown())};this.insertText=function(a,b,c){1E3==b&&(b=a.length-1);null==b&&(b=a.indexOf("{")+1,0>=b?(a+=" ",b=a.length):"}"!=a.charAt(b)&&(b=a.indexOf("}",b)+1));var d=null==c?b:c,f;c=this.equation_input;var k="left"==a.substring(1,5);if(document.selection){c.focus();var h=document.selection.createRange();f=this.equation_input.value.length+1;for(var l=h.duplicate();l.parentElement()==
c&&1==l.move("character",1);)--f;(k||0<=d)&&h.text.length?(ins_point=k?7:d,null==d?b=a.length+h.text.length+1:d<b&&(b+=h.text.length),h.text=a.substring(0,ins_point)+h.text+a.substr(ins_point)):h.text=a;a=c.createTextRange();a.collapse(!0);b=f+b;b-=c.value.substr(0,b).split("\n").length-1;a.moveEnd("character",b);a.moveStart("character",b);a.select()}else c.selectionStart||"0"==c.selectionStart?(f=c.selectionStart,h=c.selectionEnd,l=f+a.length,(k||0<=d)&&h>f&&(ins_point=k?7:d,null==d?b=a.length+h-
f+1:d<b&&(b+=h-f),a=a.substring(0,ins_point)+c.value.substring(f,h)+a.substr(ins_point)),c.value=c.value.substring(0,f)+a+c.value.substring(h,c.value.length),c.selectionStart=l,c.selectionEnd=l,c.focus(),c.setSelectionRange(f+b,f+b)):c.value+=a;this.textchanged();this.autorenderEqn(10);EqEditor.Panel.close(null);c.focus()};this.getLaTeX=function(){var a=this.equation_input.value.replace(/^\s+|\s+$/g,"").replace(/\s+/g," ");return 0<a.length?EqEditor.getSize()+a:""};this.getEquationStr=function(){var a=
this.getLaTeX();return 0<a.length?EqEditor.getCompressed()+EqEditor.getDPI()+EqEditor.getBG()+EqEditor.getFont()+a:""};this.exportMessage=function(a){var b=EqEditor.$("exportmessage");b&&(b.innerHTML=a)};this.exportEquation=function(a){var b=EqEditor.getFormat();switch(a){case "safe":return this.getEquationStr().replace(/\s/g,"\x26space;").replace(/\+/g,"\x26plus;").replace(/#/g,"\x26hash;");case "encoded":return escape(this.getEquationStr()).replace(/\+/g,"\x26plus;");case "wp":return this.exportMessage("Wordpress markup for this equation is:"),
EqEditor.get_inline_wrap(this.getLaTeX(),"[latex]{$TEXT}[/latex]\n","$latex {$TEXT}$ ");case "phpBB":return this.exportMessage("PHP Bulletin Board markup for this equation is:"),"[tex]"+this.getLaTeX()+"[/tex]\n";case "tw":return this.exportMessage("TiddlyWiki markup for this equation is:"),text=this.getEquationStr(),text=text.replace(/\[/g,"%5B"),text=text.replace(/\]/g,"%5D"),"[img["+EQUATION_ENGINE+"/"+b+".latex?"+text.replace(/#/g,"\x26hash;")+"]]";case "url":return this.exportMessage("The URL link to this equation is:"),
EQUATION_ENGINE+"/"+b+".latex?"+this.exportEquation("safe");case "urlencoded":return this.exportMessage("The Encoded URL link to this equation is:"),EQUATION_ENGINE+"/"+b+".latex?"+this.exportEquation("encoded");case "pre":return this.exportMessage("HTML code using pre-tags is:"),EqEditor.get_inline_wrap(this.getLaTeX(),'\x3cpre xml:lang\x3d"latex"\x3e{$TEXT}\x3c/pre\x3e\n','\x3ccode xml:lang\x3d"latex"\x3e{$TEXT}\x3c/code\x3e ');case "doxygen":return this.exportMessage("DOxygen markup for this equation is:"),
EqEditor.get_inline_wrap(this.getLaTeX(),"\\f[{$TEXT}\\f]\n","\\f${$TEXT}\\f$ ");case "htmledit":return this.exportMessage("HTML code to embed this equation into a web page is:"),a=this.exportEquation("safe"),"swf"==b?'\x3ca href\x3d"'+EDIT_ENGINE+"?latex\x3d"+a+'" target\x3d"_blank"\x3e'+AC_FL_RunContent("codebase",EDITOR_SW_FLASH,"width","600","height","100","src",EQUATION_ENGINE+"/swf.latex?"+a,"quality","high","pluginspage",EDITOR_SW_PLAYER,"align","top","scale","showall","wmode","window","devicefont",
"false","bgcolor","#ffffff","menu","true","allowFullScreen","true","movie",EQUATION_ENGINE+"/swf.latex?"+text)+"\x3c/a\x3e":'\x3ca href\x3d"'+EDIT_ENGINE+"?latex\x3d"+a+'" target\x3d"_blank"\x3e\x3cimg src\x3d"'+EQUATION_ENGINE+"/"+b+".latex?"+a+'" title\x3d"'+this.getLaTeX()+'" /\x3e\x3c/a\x3e';case "html":return this.exportMessage("HTML code to embed this equation into a web page is:"),a=this.exportEquation("safe"),"swf"==b?AC_FL_RunContent("codebase",EDITOR_SW_FLASH,"width","600","height","100",
"src",EQUATION_ENGINE+"/swf.latex?"+a,"quality","high","pluginspage",EDITOR_SW_PLAYER,"align","top","scale","showall","wmode","window","devicefont","false","bgcolor","#ffffff","menu","true","allowFullScreen","true","movie",EQUATION_ENGINE+"/swf.latex?"+a):'\x3cimg src\x3d"'+EQUATION_ENGINE+"/"+b+".latex?"+a+'" title\x3d"'+this.getLaTeX()+'" /\x3e';default:return this.exportMessage("LaTeX markup for this equation is:"),EqEditor.get_inline_wrap(this.getLaTeX(),"\\[{$TEXT}\\]\n","${$TEXT}$ ")}};this.setdownload=
function(a){this.equation_download&&(this.equation_download.innerHTML=a)};this.setcomment=function(a){this.equation_comment&&(this.equation_comment.innerHTML=a)};this.renderEqn=function(a){a=this.equation_input.value;a=a.replace(/^\s+|\s+$/g,"");if(0==a.length)return!0;var b=0,c;for(c=0;c<a.length;c++)switch(a.charAt(c)){case "{":0!=c&&"\\"==a[c-1]||b++;break;case "}":0!=c&&"\\"==a[c-1]||b--}if(0==b){EqEditor.$("renderbutton")&&(EqEditor.$("renderbutton").className="greybutton");b=this.equation_preview;
a=this.exportEquation("encoded");c=a.replace(/"/g,'\\"');var d=EqEditor.getFormat();if(this.changed){this.setcomment("");switch(d){case "gif":case "png":case "svg":b.src=EQUATION_ENGINE+"/"+d+".latex?"+a;this.setdownload('\x3ca href\x3d"'+EQUATION_ENGINE+"/"+d+".download?"+c+'"\x3eClick here to Download Image ('+d.toUpperCase()+")\x3c/a\x3e");break;case "pdf":b.src=EQUATION_ENGINE+"/gif.latex?"+a,this.setdownload('\x3ca target\x3d"_blank" href\x3d"'+EQUATION_ENGINE+"/pdf.download?"+c+'"\x3e\x3cimg src\x3d"images/pdf.jpg" width\x3d"30" height\x3d"30" align\x3d"middle" /\x3eClick here to Download Equation (PDF)\x3c/a\x3e')}this.updateExportArea()}}else 0>
b?this.setcomment("\x3cbr/\x3e\x3cspan class\x3d\"orange\"\x3eYou have more \x3cstrong\x3eclosed '}' brackets\x3c/strong\x3e than open '{' brackets\x3c/span\x3e"):this.setcomment("\x3cbr/\x3e\x3cspan class\x3d\"orange\"\x3eYou have more \x3cstrong\x3eopen '{' brackets\x3c/strong\x3e than closed '}' brackets\x3c/span\x3e");this.changed=!1};this.clickval=0;this.countclick=function(){var a=this.equation_input.value;this.clickval++;3<=this.clickval&&(this.clickval=0,0==this.myUndo||this.store_text[this.myUndo]!=
a)&&(20<this.myUndo?this.store_text.shift():this.myUndo++,this.store_text[this.myUndo]=a);this.myRedo=0};this.undo=function(a){0==this.myRedo&&(20<this.myUndo?this.store_text.shift():this.myUndo++,this.store_text[this.myUndo]=this.equation_input.value);if(this.myRedo<this.myUndo){this.myRedo++;this.myRedo==this.myUndo&&EqEditor.$("undobutton")&&(EqEditor.$("undobutton").src=EDITOR_SRC+"/images/buttons/undo-x.gif");if(a=EqEditor.$("redobutton"))a.src=EDITOR_SRC+"/images/buttons/redo.gif";z=this.store_text.length-
this.myRedo-1;this.equation_input.value=this.store_text[z]?this.store_text[z]:this.store_text[0];this.equation_input.focus()}};this.redo=function(a){if(0<this.myRedo){this.myRedo--;0==this.myRedo&&EqEditor.$("redobutton")&&(EqEditor.$("redobutton").src=EDITOR_SRC+"/images/buttons/redo-x.gif");if(a=EqEditor.$("undobutton"))a.src=EDITOR_SRC+"/images/buttons/undo.gif";a=this.store_text.length-this.myRedo-1;this.equation_input.value=this.store_text[a]?this.store_text[a]:this.store_text[0];this.equation_input.focus()}};
this.Export=function(a,b){EqEditor.Example.add_history(this.equation_input.value);EqEditor.Example.hide();a(this.exportEquation(b))};this.load=function(a){"undefined"!==typeof a&&this.setText(a)};void 0!==a&&this.set(a,b,c,d,f)}
var EqEditor={SID:0,copy_button:null,key_text:"",format:"gif",$:function(a){return document.getElementById(a)},OnChange:function(a,b){var c=EqEditor.$(a);c&&(c.onchange=b)},OnClick:function(a,b){var c=EqEditor.$(a);c&&(c.onclick=b)},Gallery:null,Example:{lastbutton:null,load_json:function(a,b){var c=EqEditor.$("load_json");null!=c&&(c.parentNode.removeChild(c),delete c);b="rand\x3d"+(new Date).getTime()+"\x26"+b;var c=document.getElementsByTagName("head")[0],d=document.createElement("script");d.src=
FAVORITE_ENGINE+"/"+a+"?"+b;d.id="load_json";c.appendChild(d)},add_fav:function(){text=EqEditor.targetArea.getEquationStr();""!=text&&(this.load_json("favorite_json.php","sid\x3d"+EqEditor.SID+"\x26add\x26eqn\x3d"+escape(text.replace(/\+/g,"@plus;").replace(/#/g,"@hash;"))),setTimeout("EqEditor.Example.show(null, 'fav')",200))},del_fav:function(a){this.load_json("favorite_json.php","sid\x3d"+EqEditor.SID+"\x26delete\x3d"+a);setTimeout("EqEditor.Example.show(null, 'fav')",200)},add_history:function(a){""!=
a&&this.load_json("history_json.php","sid\x3d"+EqEditor.SID+"\x26add\x26eqn\x3d"+escape(a.replace(/\+/g,"@plus;").replace(/#/g,"@hash;")))},show:function(a,b){EqEditor.$("bar1").style.display="none";EqEditor.$("bar2").style.display="block";EqEditor.$("photos")&&(EqEditor.$("photos").innerHTML="");null!==a&&(null!==this.lastbutton&&(this.lastbutton.className="lightbluebutton"),a.className="greybutton",this.lastbutton=a);EqEditor.Gallery=new Scroll;"fav"==b||"history"==b?EqEditor.Gallery.init("photos",
"leftarrow","rightarrow","overview",FAVORITE_ENGINE+"/example_json.php?fn\x3dEqEditor.Gallery\x26rand\x3d"+(new Date).getTime()+"\x26sid\x3d"+EqEditor.SID):EqEditor.Gallery.init("photos","leftarrow","rightarrow","overview",FAVORITE_ENGINE+"/example_json.php?fn\x3dEqEditor.Gallery");EqEditor.Gallery.visible_num=1;EqEditor.Gallery.new_offset=5;EqEditor.Gallery.maxpanels=1;EqEditor.Gallery.set_width(600,100,60);EqEditor.Gallery.set_subtext("\x26type\x3d"+b);EqEditor.Gallery.add_panel();EqEditor.Gallery.setarrow();
EqEditor.Gallery.setoverview()},hide:function(){EqEditor.$("bar2").style.display="none";EqEditor.$("bar1").style.display="block";null!==this.lastbutton&&(this.lastbutton.className="lightbluebutton");this.lastbutton=null}},Opacity:{set:function(a,b){var c=EqEditor.$(a).style;c.opacity=b/100;c.MozOpacity=b/100;c.KhtmlOpacity=b/100;c.filter="alpha(opacity\x3d"+b+")"},fade:function(a,b,c,d){speed=Math.round(d/100);sgn=b>c?-1:1;count=sgn*(c-b);for(i=1;i<count;i++)setTimeout("EqEditor.Opacity.set('"+a+
"',"+(i*sgn+b)+")",i*speed)},fadeout:function(a){EqEditor.$(a)&&(this.fade(a,100,10,800),setTimeout("EqEditor.$('"+a+"').style.display\x3d'none'",800))},fadein:function(a){EqEditor.$(a)&&(this.set(a,20),EqEditor.$(a).style.display="block",this.fade(a,20,100,800))}},Panel:{plock:null,ctimer:null,otimer:null,oid:null,timer:[],setstate:function(a,b){if(a){var c=a.id;""!=this.timer[c]&&(clearTimeout(this.timer[c]),this.timer[c]="");this.timer[c]=setTimeout("EqEditor.$('"+c+"').style.overflow\x3d'"+b+
"'; EqEditor.$('"+c+"').style.position\x3d'relative';",200)}},open:function(a){this.setstate(a,"visible")},close:function(a){this.setstate(a,"hidden")},hoverdiv:null,hlock:!1,hover:function(a,b){if(this.hoverdiv){this.lock=!0;this.hoverdiv.innerHTML='\x3cimg src\x3d"'+EQUATION_ENGINE+"/gif.latex?\\200dpi "+a.latex+'"/\x3e';if("pageX"in b)var c=event.pageX,d=event.pageY;else c=event.clientX+document.documentElement.scrollLeft,d=event.clientY+document.documentElement.scrollTop;var f=EqEditor.$("EqnEditor");
f&&(f=f.getBoundingClientRect(),c-=f.left,d-=f.top);this.hoverdiv.style.left=c+20+"px";this.hoverdiv.style.top=d-10+"px";this.hoverdiv.style.display="block";this.lock=!1;a.onmouseout=EqEditor.Panel.hidehover}},hidehover:function(){this.hlock||(EqEditor.$("hover").style.display="none")},init:function(a,b){this.hoverdiv=EqEditor.$(a);var c;c=void 0!==b?EqEditor.$(b):document;var d=c.getElementsByTagName("area");for(i=0;i<d.length;i++)d[i].onmouseover=function(a){EqEditor.Panel.hover(this,a)},latex=
d[i].alt,d[i].latex=latex,d[i].alt="",""==d[i].title&&(d[i].title=latex),void 0==d[i].onclick&&(d[i].onclick=function(){EqEditor.insert(this.latex)});void 0==c.getElementsByClassName&&(c.getElementsByClassName=function(a){for(var b=new RegExp("(?:^|\\s)"+a+"(?:$|\\s)"),d=c.getElementsByTagName("*"),q=[],p,r=0;null!=(p=d[r]);r++){var k=p.className;k&&-1!=k.indexOf(a)&&b.test(k)&&q.push(p)}return q});d=c.getElementsByClassName("panel");for(i=0;i<d.length;i++)""!=d[i].id&&(d[i].onmouseover=function(a){EqEditor.Panel.open(this)},
d[i].onmouseout=function(a){EqEditor.Panel.close(this)})}},Cookie:{nocookies:!1,set:function(a,b,c){var d="1"==EqEditor.Cookie.get("eqeditor_cookies");if(!this.nocookies||d||confirm("This site uses cookie to remember your preference. Are you ok with this?"))d=new Date,d.setDate(d.getDate()+c),document.cookie=a+"\x3d"+escape(b)+(null==c?";SameSite\x3dNone; Secure":";SameSite\x3dNone; Secure;expires\x3d"+d.toGMTString()),document.cookie="eqeditor_cookies\x3d1;SameSite\x3dNone; Secure"},get:function(a){return 0<
document.cookie.length&&(c_start=document.cookie.indexOf(a+"\x3d"),-1!=c_start)?(c_start=c_start+a.length+1,c_end=document.cookie.indexOf(";",c_start),-1==c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))):""}},setAdvert:function(){var a=EqEditor.$("latex_formula").offsetWidth;"auto"==EqEditor.$("wrap").style.marginLeft&&(a-=170);EqEditor.$("advert").style.display=600>a?"none":"block";EqEditor.$("wrap").style.marginLeft=600>a?"auto":"170px"},setSelIndx:function(a,
b){var c=EqEditor.$(a);if(c)for(var d=0;d<c.options.length;d++)if(c.options[d].value==b)return c.options[d].selected=!0;return!1},ExportButton:{bArray_id:[],bArray_area:[],bArray_mode:[],bArray_fn:[],bsize:0,state:function(a){for(i=0;i<this.bsize;i++)this.bArray_id[i].className=a?"lightbluebutton":"greybutton"},add:function(a,b,c,d){if(b=EqEditor.$(b))this.bArray_id[this.bsize]=b,this.bArray_area[this.bsize]=a,this.bArray_mode[this.bsize]=d,this.bArray_fn[this.bsize]=c,b.onclick=function(a){a=this.exportid;
EqEditor.ExportButton.bArray_area[a].Export(EqEditor.ExportButton.bArray_fn[a],EqEditor.ExportButton.bArray_mode[a]);window.close()},b.exportid=this.bsize,this.bsize++}},targetArray:[],targetSize:0,targetArea:null,curTarget:0,changeExportArea:function(a,b){for(i=0;i<this.targetSize;i++)this.targetArray[i].changeExportArea(a,b)},autorenderEqn:function(a){this.targetArea.autorenderEqn(a)},change:function(a){a!=this.curTarget&&(this.curTarget=a,this.key_rext="");this.targetArea=this.targetArray[a]},
add:function(a,b){this.targetArray[this.targetSize]=a;a.equation_input.onfocus=new Function("EqEditor.change("+this.targetSize+");");b&&(window.addEventListener?window.addEventListener("resize",new Function("EqEditor.resize("+this.targetSize+");"),!1):window.attachEvent("onresize",new Function("EqEditor.resize("+this.targetSize+");")),EqEditor.resize(this.targetSize));0==this.targetSize&&a.equation_input.focus();this.targetSize++},editor_id:null,embed:function(a,b,c,d){0<this.targetSize&&(this.targetArray=
[],this.targetSize=0,this.targetArea=null,this.curTarget=0);this.editor_id!=a&&(this.editor_id=a,a=EMBED_ENGINE+"?id\x3d"+a+"\x26SID\x3d"+b+"\x26design\x3d"+c,void 0!=d&&""!=d&&(a+="\x26lang\x3d"+d),d=document.createElement("script"),d.setAttribute("type","text/javascript"),d.setAttribute("src",a),document.getElementsByTagName("head")[0].appendChild(d))},moveto:function(a){if(a!=this.editor_id){for(var b=EqEditor.$(a);EqEditor.$(this.editor_id).childNodes[0];){var c=EqEditor.$(this.editor_id).childNodes[0];
c.parentNode.removeChild(c);b.appendChild(c)}this.editor_id=a}},targetFn:null,copyToTarget:function(a){null!==this.targetFn&&this.targetFn(a)},reset:function(){this.setSelIndx("format","gif");this.setSelIndx("font","");this.setSelIndx("fontsize","");this.setSelIndx("dpi","110");this.setSelIndx("bg","Transparent")},init:function(a,b,c,d){EqEditor.Panel.init("hover",d);""==a?(this.SID=EqEditor.Cookie.get("eqeditor"),this.SID||(this.SID=(new Date).getTime(),EqEditor.Cookie.set("eqeditor",a,30))):this.SID=
a;void 0!==b&&(this.add(b,c),this.targetArea=b);this.setSelIndx("format",EqEditor.Cookie.get("format"));this.setSelIndx("font",EqEditor.Cookie.get("font"));this.setSelIndx("fontsize",EqEditor.Cookie.get("fontsize"));this.setSelIndx("dpi",EqEditor.Cookie.get("dpi"));this.setSelIndx("bg",EqEditor.Cookie.get("bg"));EqEditor.OnClick("undobutton",function(a){EqEditor.targetArea.undo()});EqEditor.OnClick("redobutton",function(a){EqEditor.targetArea.redo()});EqEditor.OnChange("bg",function(a){(a=EqEditor.$("bg"))&&
EqEditor.Cookie.set("bg",a.value,10);EqEditor.update()});EqEditor.OnChange("dpi",function(a){(a=EqEditor.$("dpi"))&&EqEditor.Cookie.set("dpi",a.value,10);EqEditor.update()});EqEditor.OnChange("font",function(a){(a=EqEditor.$("font"))&&EqEditor.Cookie.set("font",a.value,10);EqEditor.update()});EqEditor.OnChange("format",function(a){EqEditor.setFormat(EqEditor.getFormat())});EqEditor.OnChange("fontsize",function(){var a=EqEditor.$("fontsize");a&&EqEditor.Cookie.set("fontsize",a.value,10);EqEditor.update()});
EqEditor.OnClick("inline",function(a){if(a=EqEditor.$("compressed"))a.checked=this.checked;EqEditor.update()});EqEditor.OnClick("compressed",function(a){EqEditor.update()})},textchanged:function(){this.targetArea.textchanged()&&EqEditor.ExportButton.state(!0)},update:function(){this.targetArea.textchanged();this.targetArea.renderEqn(null)},load:function(a){null!=this.targetArea&&this.targetArea.load(a)},insert:function(a,b,c){null!=this.targetArea&&(this.targetArea.insertText(a,b,c),EqEditor.ExportButton.state(!0))},
getTextArea:function(){return null!=this.targetArea?this.targetArea:null},clearText:function(){this.targetArea.clearText();EqEditor.ExportButton.state(!1)},setFormat:function(a){EqEditor.format=a;switch(a){default:action=!1;break;case "pdf":case "swf":case "emf":case "svg":action=!0}EqEditor.Cookie.set("format",a,10);if(a=EqEditor.$("dpi"))a.disabled=action,a.readonly=action;if(a=EqEditor.$("bg"))a.disabled=action,a.readonly=action;EqEditor.targetArea.changed=!0;EqEditor.targetArea.renderEqn(null)},
getFormat:function(){var a=EqEditor.$("format");return a?a.value:EqEditor.format},getFont:function(){var a=EqEditor.$("font");return a&&""!=a.value?"\\fn_"+a.value+" ":""},getSize:function(){var a=EqEditor.$("fontsize");return a&&""!=a.value?a.value+" ":""},getDPI:function(){var a=EqEditor.$("dpi");return a&&"110"!=a.value?"\\dpi{"+a.value+"} ":""},getBG:function(){var a=EqEditor.$("bg");return a&&(a=a.value.toLowerCase(),"transparent"!=a)?"\\bg_"+a+" ":""},getCompressed:function(){var a=EqEditor.$("compressed");
return a&&a.checked?"\\inline ":""},get_inline_wrap:function(a,b,c){var d=EqEditor.$("inline");if(d){var f=EqEditor.$("compressed");if(d.checked)return f.checked||(a="\\displaystyle "+a),c.replace("{$TEXT}",a);f.checked&&(a="\\inline "+a)}return b.replace("{$TEXT}",a)},extendchar:null,countclick:function(){this.targetArea.countclick();var a=EqEditor.$("redobutton");a&&(a.src=EDITOR_SRC+"/images/buttons/redo-x.gif");if(a=EqEditor.$("undobutton"))a.src=EDITOR_SRC+"/images/buttons/undo.gif"},tabHandler:function(a){var b=
this.targetArea.equation_input;if(9==a.keyCode){if(document.selection){var c=document.selection.createRange();i=b.value.length+1;for(c=c.duplicate();c.parentElement()==b&&1==c.move("character",1);)--i;startPos=i}else startPos=b.selectionStart;if(startPos==b.value.length)return!0;c=b.value.indexOf("{",startPos);-1==c?c=b.value.length:c++;var d=b.value.indexOf("\x26",startPos);-1==d?d=b.value.length:d++;var f=b.value.indexOf("\\\\",startPos),f=-1==f?b.value.length:f+2,c=Math.min(Math.min(c,d),f);document.selection?
(range=b.createTextRange(),range.collapse(!0),c-=b.value.substr(0,c).split("\n").length-1,range.moveEnd("character",c),range.moveStart("character",c),range.select()):b.setSelectionRange(c,c);a.preventDefault?a.preventDefault():a.returnValue=!1;return!1}},backCursor:function(a){if(document.selection)a.focus(),sel=document.selection.createRange(),0<sel.text.length||sel.moveEnd("character",1),sel.text="",sel.select();else if(a.selectionStart||"0"==a.selectionStart)s=a.selectionStart,e=a.selectionEnd,
a.value=a.value.substring(0,s)+a.value.substring(e+1,a.value.length),a.selectionStart=s,a.selectionEnd=s,a.focus()},extendkey:function(a){switch(this.key_text){case "\\left":this.insert(" \\right "+a,0);break;case "\\frac":case "\\tfrac":"}"==a&&this.insert("}{}",0);break;case "\\begin":"}"==a&&this.insert("} \\end{}",0);break;default:this.insert(a,0)}this.extendchar=a},keyHandler:function(a){var b;window.event?b=window.event.keyCode:a&&(b=a.which);a=String.fromCharCode(b);a==this.extendchar&&this.backCursor(this.equation_input);
this.extendchar=null;switch(a){case "{":this.extendkey("}");break;case "[":this.extendkey("]");break;case "(":this.extendkey(")");break;case '"':this.extendkey('"')}" "!=a&&("\\"==a?this.key_text="\\":a.match(/^[a-zA-Z]$/)?this.key_text+=a:this.key_text="")},addText:function(a,b,c){b=a.getElementById(b);if(a.selection)b.focus(),sel=a.selection.createRange(),sel.text=c;else{a=b.scrollTop;if(b.selectionStart||"0"==b.selectionStart){var d=b.selectionStart,f=b.selectionEnd,g=d+c.length;b.value=b.value.substring(0,
d)+c+b.value.substring(f,b.value.length);pos=c.length+f-d;b.selectionStart=g;b.selectionEnd=g;b.focus();b.setSelectionRange(d+pos,d+pos)}else b.value+=c;b.scrollTop=a}},makeEquationsMatrix:function(a,b,c){void 0===b&&(b=!1);void 0===c&&(b=!1);eqns="\\begin{"+a+(b?"":"*")+"}";eqi="\n \x26"+(b?" ":"\x3d ")+(c?"\\text{ if } x\x3d ":"");eqEnd="\n\\end{"+a+(b?"":"*")+"}";i=0;dim=prompt("Enter the number of lines:","");if(""!=dim&&null!==dim&&(n=parseInt(dim),!isNaN(n))){for(i=1;i<=n-1;i++)eqns+=eqi+"\\\\ ";
eqns=eqns+eqi+eqEnd;this.insert(eqns,a.length+(b?0:1)+9)}},makeArrayMatrix:function(a,b,c){var d=b+"\\begin{"+a+"matrix}",f="\n";c="\n\\end{"+a+"matrix}"+c;var g=0,g=prompt('Enter the array dimensions separated by a comma (e.g. "2,3" for 2 rows and 3 columns):',"");if(""!==g&&null!==g&&(g=g.split(","),m=parseInt(g[0]),n=parseInt(g[1]),!isNaN(m)&&!isNaN(n))){for(g=2;g<=n;g++)f+=" \x26 ";for(g=1;g<=m-1;g++)d=d+f+"\\\\ ";this.insert(d+f+c,a.length+b.length+15)}},resize:function(a){var b;self.innerHeight?
b=self.innerHeight:document.documentElement&&document.documentElement.clientHeight?b=document.documentElement.clientHeight:document.body&&(b=document.body.clientHeight);this.targetArray[a].equation_input.style.height=parseInt(Math.max((b-200)/3,40))+"px"}},oDiv=document.createElement("div"),oImg=document.createElement("img"),Scroll=function(){};
Scroll.prototype={init:function(a,b,c,d,f){this.maxpanels=this.panels=0;this.speed=10;this.pause=2;this.visible=0;this.visible_num=2;this.layers=[];this.layers_offset=[];this.new_offset=0;this.subtext="";this.vertical=!1;this.left_arrow=document.getElementById(b);this.right_arrow=document.getElementById(c);this.maindiv=document.getElementById(a);this.overview=""!==d?document.getElementById(d):null;if(-1<f.indexOf("_json"))this.ajax_php=null,this.json_php=f,this.ajax_response_fn=null;else{this.ajax_php=
f;this.json_php=null;var g=this;this.ajax_response_fn=function(){g.add_panel_response()}}},set_subtext:function(a){this.subtext=a},set_width:function(a,b,c){this.width=a;this.height=b;this.speed=c;this.step=this.vertical?this.step_total=this.height/this.speed:this.step_total=this.width/this.speed},add:function(a){var b=this.new_offset;this.new_offset=this.vertical?this.new_offset+this.height:this.new_offset+this.width;this.layers[this.panels]=a;this.layers_offset[this.panels]=b;this.panels++;this.panels>
this.maxpanels&&(this.maxpanels=this.panels);a.style.position="absolute";this.vertical?a.style.top=b+"px":a.style.left=b+"px"},add_id:function(a){(a=document.getElementById(a))&&this.add(a)},add_panel_div:function(a){this.add(a);this.maindiv.appendChild(a);this.visible+this.visible_num>=this.panels&&this.add_panel()},add_panel_response:function(){if(4==req.readyState){if(200==req.status&&0<req.responseText.length){var a=oDiv.cloneNode(!1);a.innerHTML=req.responseText;this.add_panel_div(a)}this.setarrow();
this.setoverview()}},add_panel_json:function(a){if(0<a.length){var b=oDiv.cloneNode(!1);b.innerHTML=a;this.add_panel_div(b)}this.setarrow();this.setoverview()},add_panel:function(){if(this.ajax_php&&this.ajax_response_fn)-1==this.ajax_php.indexOf("?")?loadXMLDoc(this.ajax_php+"?panel\x3d"+this.panels+this.subtext,this.ajax_response_fn):loadXMLDoc(this.ajax_php+"\x26panel\x3d"+this.panels+this.subtext,this.ajax_response_fn);else if(this.json_php){var a=this.panels,b=document.getElementsByTagName("head")[0],
c=document.createElement("script");-1==this.json_php.indexOf("?")?c.src=this.json_php+"?panel\x3d"+a+this.subtext:c.src=this.json_php+"\x26panel\x3d"+a+this.subtext;b.appendChild(c)}},redraw:function(){if(this.json_php||this.ajax_php&&this.ajax_response_fn)for(this.new_offset=this.visible=this.panels=0;this.maindiv.firstChild;)this.maindiv.removeChild(this.maindiv.firstChild);if(this.ajax_php&&this.ajax_response_fn)-1==this.ajax_php.indexOf("?")?loadXMLDoc(this.ajax_php+"?panel\x3d"+this.panels+this.subtext,
this.ajax_response_fn):loadXMLDoc(this.ajax_php+"\x26panel\x3d"+this.panels+this.subtext,this.ajax_response_fn);else if(this.json_php){var a=this.panels,b=document.getElementsByTagName("head")[0],c=document.createElement("script");-1==this.json_php.indexOf("?")?c.src=this.json_php+"?panel\x3d"+a+this.subtext:c.src=this.json_php+"\x26panel\x3d"+a+this.subtext;b.appendChild(c)}},move:function(a){this.new_offset+=a;for(var b=0;b<this.panels;b++)this.layers_offset[b]+=a,this.vertical?this.layers[b].style.top=
this.layers_offset[b]+"px":this.layers[b].style.left=this.layers_offset[b]+"px";this.step++;if(this.step<this.step_total){var c=this;window.setTimeout(function(){c.move(a)},this.pause)}},setoverview:function(){if(null!==this.overview){this.overview.innerHTML="";var a=this;for(i=0;i<this.maxpanels;i++)newimg=oImg.cloneNode(!1),newimg.className="overview",i>=this.visible&&i<this.visible+this.visible_num?newimg.src="http://www.codecogs.com/images/scroll/soliddot.gif":(newimg.src="http://www.codecogs.com/images/scroll/emptydot.gif",
newimg.i=i,newimg.onclick=function(){a.jump(this)}),this.overview.appendChild(newimg)}},setarrow:function(){this.left_arrow.src="http://www.codecogs.com/images/scroll/"+(0>=this.visible?"leftarrow_grey.gif":"leftarrow.gif");this.right_arrow.src="http://www.codecogs.com/images/scroll/"+(this.visible>=this.panels-1?"rightarrow_grey.gif":"rightarrow.gif")},jump:function(a){this.step==this.step_total&&(panel=a.i,a=panel-this.visible,this.step=this.step_total-Math.abs(a)*this.step_total,this.visible>panel?
this.move(this.speed):this.move(-this.speed),this.visible+=a,this.visible+this.visible_num>=this.panels?this.add_panel():(this.setarrow(),this.setoverview()))},left:function(){this.step==this.step_total&&this.visible<this.panels-1&&(this.visible++,this.step=0,this.move(-this.speed),this.visible+this.visible_num>=this.panels?this.add_panel():(this.setarrow(),this.setoverview()))},right:function(){this.step==this.step_total&&0<this.visible&&(this.step=0,this.move(this.speed),this.visible--,this.setarrow(),
this.setoverview())},subsearch:function(a){this.subtext=""!==a?"\x26subtext\x3d"+a:"";this.redraw()}};