/*
 Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
*/
CKEDITOR.dialog.add("image2",function(e){function t(){var a=this.getValue().match(F);(a=!(!a||0===parseInt(a[1],10)))||alert(c.invalidLength.replace("%1",c[this.id]).replace("%2","px"));return a}function P(){function a(a,c){u.push(b.once(a,function(a){for(var b;b=u.pop();)b.removeListener();c(a)}))}var b=v.createElement("img"),u=[];return function(u,c,d){a("load",function(){var a=G(b);c.call(d,b,a.width,a.height)});a("error",function(){c(null)});a("abort",function(){c(null)});b.setAttribute("src",
(C.baseHref||"")+u)}}function H(){var a=this.getValue();w(!1);if(a!==x.data.src){if(y)y.on("load",function(){e.fire("change")});I(a,function(a,b,c){w(!0);if(!a)return k(!1);f?f.setValue(!1===e.config.image2_prefillDimensions?0:b):"";d?d.setValue(!1===e.config.image2_prefillDimensions?0:c):"";z=b;A=c;k(J.checkHasNaturalRatio(a))});m=!0}else m?(w(!0),d?f.setValue(n):"",d?d.setValue(p):"",m=!1):w(!0)}function B(){if(g){var a=this.getValue();if(a&&(a.match(F)||k(!1),"0"!==a)){var b="width"==this.id,c=
n||z,e=p||A,a=b?Math.round(a/c*e):Math.round(a/e*c);isNaN(a)||(b?d:f).setValue(a)}}}function K(){function a(a){a.on("mouseover",function(){this.addClass("cke_btn_over")},a);a.on("mouseout",function(){this.removeClass("cke_btn_over")},a)}var b=this.getDialog();h=v.getById(L);q=v.getById(M);h&&(b.addFocusable(h,4+N),h.on("click",function(a){k();a.data&&a.data.preventDefault()},this.getDialog()),a(h));q&&(b.addFocusable(q,5+N),q.on("click",function(a){m?(f?f.setValue(z):"",d?d.setValue(A):""):(f?f.setValue(n):
"",d?d.setValue(p):"");a.data&&a.data.preventDefault()},this),a(q))}function k(a){if(h){if("boolean"==typeof a){if(D)return;g=a}else a=f.getValue(),D=!0,(g=!g)&&a&&(a*=p/n,isNaN(a)||d.setValue(Math.round(a)));h[g?"removeClass":"addClass"]("cke_btn_unlocked");h.setAttribute("aria-checked",g);CKEDITOR.env.hc&&h.getChild(0).setHtml(g?CKEDITOR.env.ie?"■":"▣":CKEDITOR.env.ie?"□":"▢")}}function w(a){a=a?"enable":"disable";f?f[a]():"";d?d[a]():""}var F=/(^\s*(\d+)(px)?\s*$)|^$/i,L=CKEDITOR.tools.getNextId(),
M=CKEDITOR.tools.getNextId(),b=e.lang.image2,c=e.lang.common,r=(new CKEDITOR.template('\x3cdiv\x3e\x3ca href\x3d"javascript:void(0)" tabindex\x3d"-1" title\x3d"'+b.lockRatio+'" class\x3d"cke_btn_locked" id\x3d"{lockButtonId}" role\x3d"checkbox"\x3e\x3cspan class\x3d"cke_icon"\x3e\x3c/span\x3e\x3cspan class\x3d"cke_label"\x3e'+b.lockRatio+'\x3c/span\x3e\x3c/a\x3e\x3ca href\x3d"javascript:void(0)" tabindex\x3d"-1" title\x3d"'+b.resetSize+'" class\x3d"cke_btn_reset" id\x3d"{resetButtonId}" role\x3d"button"\x3e\x3cspan class\x3d"cke_label"\x3e'+
b.resetSize+"\x3c/span\x3e\x3c/a\x3e\x3c/div\x3e")).output({lockButtonId:L,resetButtonId:M}),J=CKEDITOR.plugins.image2,C=e.config,N=!(!C.filebrowserImageBrowseUrl&&!C.filebrowserBrowseUrl),l=e.widgets.registered.image.features,G=J.getNatural,v,x,y,I,n,p,z,A,m,g,D,h,q,f,d,E,O=[{id:"src",type:"text",label:b.url,onKeyup:H,onChange:H,setup:function(a){this.setValue(a.data.src)},commit:function(a){a.setData("src",this.getValue())},validate:CKEDITOR.dialog.validate.notEmpty(b.urlMissing)}],r=e.config.hideFileUpload?
[{id:"info",label:b.infoTab,elements:[{type:"vbox",padding:0,children:[{type:"hbox",widths:["100%"],className:"cke_dialog_image_url",children:O}]},{id:"alt",type:"text",label:b.alt,setup:function(a){this.setValue(a.data.alt)},commit:function(a){a.setData("alt",this.getValue())},validate:!0===e.config.image2_altRequired?CKEDITOR.dialog.validate.notEmpty(b.altMissing):null},{type:"hbox",widths:["25%","25%","50%"],requiredContent:l.dimension.requiredContent,children:[{type:"text",width:"80px",id:"width",
label:c.width,validate:t,onKeyUp:B,onLoad:function(){f=this},setup:function(a){this.setValue(a.data.width)},commit:function(a){a.setData("width",this.getValue())}},{type:"text",id:"height",width:"80px",label:c.height,validate:t,onKeyUp:B,onLoad:function(){d=this},setup:function(a){this.setValue(a.data.height)},commit:function(a){a.setData("height",this.getValue())}},{id:"lock",type:"html",style:"margin-top:50px;width:40px;height:20px;",onLoad:K,setup:function(a){k(a.data.lock)},commit:function(a){a.setData("lock",
g)},html:r}]},{type:"hbox",id:"alignment",requiredContent:l.align.requiredContent,children:[{id:"align",type:"radio",items:[[c.alignNone,"none"],[c.left,"left"],[c.center,"center"],[c.right,"right"]],label:c.align,setup:function(a){console.log("widget.data.align",a.data.align);this.setValue(a.data.align);0===a.data.src.length&&this.setValue("center")},commit:function(a){a.setData("align",this.getValue())}}]},{id:"hasCaption",type:"checkbox",label:b.captioned,requiredContent:l.caption.requiredContent,
setup:function(a){this.setValue(a.data.hasCaption)},commit:function(a){a.setData("hasCaption",this.getValue())}}]}]:[{id:"file",hidden:!0,filebrowser:"uploadButton",label:b.uploadTab,elements:[{type:"file",id:"file",label:"选择图片",hidden:!1,fileLabelStyle:"display: block; margin: 96px auto 0; border-radius: 5px; width: 112px; height: 38px; line-height: 38px; background: #ff5e5e; color: #fff; text-align: center; cursor: pointer;",fileStyle:"display: none;",labelStyle:"display: none",accept:"image/jpeg,image/gif,image/png,image/png,image/bmp,image/webp",
onChange:function(){this._.buttons[0].click()}},{type:"html",id:"textuploadimage",html:'\x3cp class\x3d"img-upload-tip"\x3e支持jpg、gif、png、bmp、jpeg、webp等多种格式\x3cbr\x3e单张图片最大支持5MB\x3c/p\x3e'},{type:"fileButton",id:"uploadButton",filebrowser:"info:src",label:b.btnUpload,style:"display: none;","for":["file","file"]}]},{id:"info",label:b.infoTab,elements:[{type:"vbox",padding:0,children:[{type:"hbox",widths:["100%"],className:"cke_dialog_image_url",children:O}]},{id:"alt",type:"text",label:b.alt,setup:function(a){this.setValue(a.data.alt)},
commit:function(a){a.setData("alt",this.getValue())},validate:!0===e.config.image2_altRequired?CKEDITOR.dialog.validate.notEmpty(b.altMissing):null},{type:"hbox",widths:["25%","25%","50%"],requiredContent:l.dimension.requiredContent,children:[{type:"text",width:"80px",id:"width",label:c.width,validate:t,onKeyUp:B,onLoad:function(){f=this},setup:function(a){this.setValue(a.data.width)},commit:function(a){a.setData("width",this.getValue())}},{type:"text",id:"height",width:"80px",label:c.height,validate:t,
onKeyUp:B,onLoad:function(){d=this},setup:function(a){this.setValue(a.data.height)},commit:function(a){a.setData("height",this.getValue())}},{id:"lock",type:"html",style:"margin-top:50px;width:40px;height:20px;",onLoad:K,setup:function(a){k(a.data.lock)},commit:function(a){a.setData("lock",g)},html:r}]},{type:"hbox",id:"alignment",requiredContent:l.align.requiredContent,children:[{id:"align",type:"radio",items:[[c.alignNone,"none"],[c.left,"left"],[c.center,"center"],[c.right,"right"]],label:c.align,
setup:function(a){console.log("widget.data.align",a.data.align);this.setValue(a.data.align);0===a.data.src.length&&this.setValue("center")},commit:function(a){a.setData("align",this.getValue())}}]},{id:"hasCaption",type:"checkbox",label:b.captioned,requiredContent:l.caption.requiredContent,setup:function(a){this.setValue(a.data.hasCaption)},commit:function(a){a.setData("hasCaption",this.getValue())}}]}];return{title:1<r.length?"":b.title,minHeight:100,resizable:CKEDITOR.DIALOG_RESIZE_NONE,onLoad:function(){v=
this._.element.getDocument();I=P()},onShow:function(){x=this.getModel();""!==x.data.src&&CKEDITOR.dialog.getCurrent().selectPage("info");y=x.parts.image;m=D=g=!1;E=G(y);z=n=E.width;A=p=E.height},contents:r}});