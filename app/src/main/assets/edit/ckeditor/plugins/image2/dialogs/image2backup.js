/*
 Copyright (c) 2003-2018, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
*/
CKEDITOR.dialog.add("image2",function(k){function B(){var a=this.getValue().match(C);(a=!(!a||0===parseInt(a[1],10)))||alert(e.invalidLength.replace("%1",e[this.id]).replace("%2","px"));return a}function M(){function a(a,b){f.push(c.once(a,function(a){for(var c;c=f.pop();)c.removeListener();b(a)}))}var c=r.createElement("img"),f=[];return function(f,b,d){a("load",function(){var a=D(c);b.call(d,c,a.width,a.height)});a("error",function(){b(null)});a("abort",function(){b(null)});c.setAttribute("src",
(w.baseHref||"")+f+"?"+Math.random().toString(16).substring(2))}}function E(){var a=this.getValue();t(!1);a!==x.data.src?(F(a,function(a,f,b){t(!0);if(!a)return l(!1);d?d.setValue(!1===k.config.image2_prefillDimensions?0:f):"";c?c.setValue(!1===k.config.image2_prefillDimensions?0:b):"";u=f;v=b;l(G.checkHasNaturalRatio(a))}),m=!0):m?(t(!0),c?d.setValue(n):"",c?c.setValue(p):"",m=!1):t(!0)}function H(){if(g){var a=this.getValue();if(a&&(a.match(C)||l(!1),"0"!==a)){var b="width"==this.id,f=n||u,e=p||
v,a=b?Math.round(a/f*e):Math.round(a/e*f);isNaN(a)||(b?c:d).setValue(a)}}}function l(a){if(h){if("boolean"==typeof a){if(y)return;g=a}else a=d.getValue(),y=!0,(g=!g)&&a&&(a*=p/n,isNaN(a)||c.setValue(Math.round(a)));h[g?"removeClass":"addClass"]("cke_btn_unlocked");h.setAttribute("aria-checked",g);CKEDITOR.env.hc&&h.getChild(0).setHtml(g?CKEDITOR.env.ie?"■":"▣":CKEDITOR.env.ie?"□":"▢")}}function t(a){a=a?"enable":"disable";d?d[a]():"";c?c[a]():""}var C=/(^\s*(\d+)(px)?\s*$)|^$/i,I=CKEDITOR.tools.getNextId(),
J=CKEDITOR.tools.getNextId(),b=k.lang.image2,e=k.lang.common,N=(new CKEDITOR.template('\x3cdiv\x3e\x3ca href\x3d"javascript:void(0)" tabindex\x3d"-1" title\x3d"'+b.lockRatio+'" class\x3d"cke_btn_locked" id\x3d"{lockButtonId}" role\x3d"checkbox"\x3e\x3cspan class\x3d"cke_icon"\x3e\x3c/span\x3e\x3cspan class\x3d"cke_label"\x3e'+b.lockRatio+'\x3c/span\x3e\x3c/a\x3e\x3ca href\x3d"javascript:void(0)" tabindex\x3d"-1" title\x3d"'+b.resetSize+'" class\x3d"cke_btn_reset" id\x3d"{resetButtonId}" role\x3d"button"\x3e\x3cspan class\x3d"cke_label"\x3e'+
b.resetSize+"\x3c/span\x3e\x3c/a\x3e\x3c/div\x3e")).output({lockButtonId:I,resetButtonId:J}),G=CKEDITOR.plugins.image2,w=k.config,K=!(!w.filebrowserImageBrowseUrl&&!w.filebrowserBrowseUrl),z=k.widgets.registered.image.features,D=G.getNatural,r,x,L,F,n,p,u,v,m,g,y,h,q,d,c,A,O=[{id:"src",type:"text",label:e.url,onKeyup:E,onChange:E,setup:function(a){this.setValue(a.data.src)},commit:function(a){a.setData("src",this.getValue())},validate:CKEDITOR.dialog.validate.notEmpty(b.urlMissing)}];return{title:b.title,
minWidth:250,minHeight:100,resizable:CKEDITOR.DIALOG_RESIZE_NONE,onLoad:function(){r=this._.element.getDocument();F=M()},onShow:function(){x=this.getModel();L=x.parts.image;m=y=g=!1;A=D(L);u=n=A.width;v=p=A.height},contents:[{id:"info",label:b.infoTab,elements:[{type:"vbox",padding:0,children:[{type:"hbox",widths:["100%"],className:"cke_dialog_image_url",children:O}]},{id:"alt",type:"text",label:b.alt,setup:function(a){this.setValue(a.data.alt)},commit:function(a){a.setData("alt",this.getValue())},
validate:!0===k.config.image2_altRequired?CKEDITOR.dialog.validate.notEmpty(b.altMissing):null},{type:"hbox",widths:["25%","25%","50%"],requiredContent:z.dimension.requiredContent,children:[{type:"text",width:"45px",id:"width",label:e.width,validate:B,onKeyUp:H,onLoad:function(){d=this},setup:function(a){this.setValue(a.data.width)},commit:function(a){a.setData("width",this.getValue())}},{type:"text",id:"height",width:"45px",label:e.height,validate:B,onKeyUp:H,onLoad:function(){c=this},setup:function(a){this.setValue(a.data.height)},
commit:function(a){a.setData("height",this.getValue())}},{id:"lock",type:"html",style:"margin-top:50px;width:40px;height:20px;",onLoad:function(){function a(a){a.on("mouseover",function(){this.addClass("cke_btn_over")},a);a.on("mouseout",function(){this.removeClass("cke_btn_over")},a)}var b=this.getDialog();h=r.getById(I);q=r.getById(J);h&&(b.addFocusable(h,4+K),h.on("click",function(a){l();a.data&&a.data.preventDefault()},this.getDialog()),a(h));q&&(b.addFocusable(q,5+K),q.on("click",function(a){m?
(d?d.setValue(u):"",c?c.setValue(v):""):(d?d.setValue(n):"",c?c.setValue(p):"");a.data&&a.data.preventDefault()},this),a(q))},setup:function(a){l(a.data.lock)},commit:function(a){a.setData("lock",g)},html:N}]},{type:"hbox",id:"alignment",requiredContent:z.align.requiredContent,children:[{id:"align",type:"radio",items:[[e.center,"center"],[e.left,"left"],[e.right,"right"]],label:e.align,setup:function(a){this.setValue("center")},commit:function(a){a.setData("align",this.getValue())}}]},{id:"hasCaption",
type:"checkbox",label:b.captioned,requiredContent:z.caption.requiredContent,setup:function(a){this.setValue(a.data.hasCaption)},commit:function(a){a.setData("hasCaption",this.getValue())}}]},{id:"file",hidden:!0,filebrowser:"uploadButton",label:b.uploadTab,elements:[{type:"file",id:"file",label:b.btnUpload,labelStyle:"font-weight:bold;font-size: 16px;margin-top:8px;margin-bottom:8px;display:none",style:"height:40px;padding-top: 24px;"},{type:"html",id:"textuploadimage",html:"\x3cspan\x3e支持.jpg .gif .png .bmp .jpeg .webp，大小不超过5M\x3cbr\x3e\x3cbr\x3e支持拖动上传图片\x3c/span\x3e"},
{type:"fileButton",id:"uploadButton",filebrowser:"info:src",label:b.btnUpload,style:"color:#fff;margin-top:16px;padding-top:8px;padding-bottom:8px;border:1px solid #bbb","for":["file","file"]}]}]}});